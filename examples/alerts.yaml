# SQL Sentinel Example Configuration
# This example uses SQLite for both the monitored data and state tracking

database:
  url: "sqlite:///examples/sample_data.db"

alerts:
  - name: "daily_revenue_check"
    description: "Alert when daily revenue falls below $10,000"
    enabled: true
    query: |
      SELECT
        CASE
          WHEN total_revenue < 10000 THEN 'ALERT'
          ELSE 'OK'
        END as status,
        total_revenue as actual_value,
        10000 as threshold,
        order_count
      FROM (
        SELECT
          SUM(amount) as total_revenue,
          COUNT(*) as order_count
        FROM orders
        WHERE date = date('now', '-1 day')
      )
    schedule: "0 9 * * *"  # 9 AM daily
    notify:
      - channel: email
        recipients:
          - "admin@example.com"
        subject: "Revenue Alert: {alert_name}"

  - name: "high_error_rate"
    description: "Alert when error rate exceeds 5%"
    enabled: true
    query: |
      SELECT
        CASE
          WHEN error_rate > 5 THEN 'ALERT'
          ELSE 'OK'
        END as status,
        error_rate as actual_value,
        5 as threshold,
        total_requests,
        error_count
      FROM (
        SELECT
          (CAST(SUM(CASE WHEN status = 'error' THEN 1 ELSE 0 END) AS FLOAT) / COUNT(*)) * 100 as error_rate,
          COUNT(*) as total_requests,
          SUM(CASE WHEN status = 'error' THEN 1 ELSE 0 END) as error_count
        FROM api_logs
        WHERE timestamp >= datetime('now', '-1 hour')
      )
    schedule: "*/15 * * * *"  # Every 15 minutes
    notify:
      - channel: email
        recipients:
          - "ops@example.com"

  - name: "data_freshness_check"
    description: "Alert when data hasn't been updated in 24 hours"
    enabled: true
    query: |
      SELECT
        CASE
          WHEN hours_since_update > 24 THEN 'ALERT'
          ELSE 'OK'
        END as status,
        hours_since_update as actual_value,
        24 as threshold,
        last_update
      FROM (
        SELECT
          (julianday('now') - julianday(MAX(updated_at))) * 24 as hours_since_update,
          MAX(updated_at) as last_update
        FROM data_pipeline
      )
    schedule: "0 */6 * * *"  # Every 6 hours
    notify:
      - channel: email
        recipients:
          - "data-team@example.com"
